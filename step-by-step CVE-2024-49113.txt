Para trigar a vulnerabilidade precisamos de um domínio na internet registro srv apontando para o nome de uma máquina que temos na mesma rede da máquina alvo.

para responder as consultas que a máquina alvo irá fazer nas queries

_ldap._tcp.Default-First-Site-Name._sites.dc._msdcs.safebreachlabs.pro
_ldap._tcp.dc._msdcs.safebreachlabs.pro

nesse caso para não comprarmos um domínio para teste, utilizaremos o domínio do laboratório safebreachlabs que publicou a poc, se validarmos com o nslookup essas queries, veremos que aponta para a máquina sbattacker.

Então criei / renomei minha máquina linux com o nome sb attacker, isso pode ser feito adicionando sbattacker ao arquivo /etc/hostname e 127.0.0.1 sbattacker ao /etc/hosts


sudo nano /etc/hostname
sudo nano /etc/hosts

Precisaremos instalar o samba para responder ao netbios broadcast que a máquina alvo irá fazer.

sudo apt-get install samba
sudo nano /etc/samba/smb.conf

adicionar no final do arquivo

[global]
netbios name = sbattacker
wins support = yes


sudo service smbd restart

podemos validar tentando pingar da máquina alvo para sbattacker

após isso podemos executar a poc passando a máquina alvo e o dominio safebreachlabs.pro